services:
  n8n-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: n8n-dev
    ports:
      # Backend API - Access at http://localhost:5678
      - "5678:5678"
      # Frontend dev server - Access at http://localhost:8080
      - "8080:8080"
    volumes:
      # Mount source code for hot reload (changes will be reflected immediately)
      - .:/home/node/app
      # Exclude node_modules from volume mount to use container's installed dependencies
      - /home/node/app/node_modules
      - /home/node/app/packages/*/node_modules
      - /home/node/app/packages/@n8n/*/node_modules
      - /home/node/app/packages/frontend/*/node_modules
      # Persist n8n data directory
      - n8n-data:/home/node/.n8n
    environment:
      - NODE_ENV=development
      - N8N_PORT=5678
      - N8N_HOST=0.0.0.0
      - N8N_PROTOCOL=http
      # Frontend API URL (frontend will connect to backend at this URL)
      - VUE_APP_URL_BASE_API=http://localhost:5678/
    stdin_open: true
    tty: true
    restart: unless-stopped

volumes:
  n8n-data:

